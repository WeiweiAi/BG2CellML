<?xml-stylesheet type="text/xsl" href="mathml.xsl"?>
<?xml-stylesheet type="text/xsl" href="http://www.w3.org/Math/XSL/mathml.xsl"?>
{% extends 'base.html' %}
{% from 'bootstrap5/form.html' import render_form %}

{% block title %}
Best Movie Actors
{% endblock %}


{% block content %}

<!--
	TIPS about using Bootstrap-Flask:
	https://github.com/helloflask/bootstrap-flask
	https://bootstrap-flask.readthedocs.io/
-->

<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
     window.onload = function() {
        var iframe = document.getElementById("myiframe");
        iframe.width = iframe.contentWindow.document.body.scrollWidth;
        iframe.height = iframe.contentWindow.document.body.scrollHeight;
     }
  </script>
  <script>
    function add_edge() {
      network= document.getElementById('myiframe').contentWindow.network;
      var selected_edges = network.getSelectedEdges();
      var new_selected_nodes = network.getConnectedNodes(selected_edges[0]);   
        $.ajax({
            url: '/add_edge',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify( {'new_edge':new_selected_nodes}),
            success: function(response) {
              document.getElementById('myiframe').contentWindow.getPydata(JSON.stringify(response.nodes),JSON.stringify(response.edges));
              document.getElementById('myiframe').contentWindow.drawGraph();
              network.fit()
            },
            error: function(error) {
                console.log(error);
            }
        });
        document.getElementById("node-pair").innerHTML = new_selected_nodes;
    }
</script>
  <script>
    function compose() {
      network= document.getElementById('myiframe').contentWindow.network;
      var selected_edges = network.getSelectedEdges();
      var new_selected_nodes = network.getConnectedNodes(selected_edges[0]);       
      var model_name = document.getElementById("name").value;
      var input =document.getElementById("name").value;
      console.log(model_name);
      $.ajax({
          url: '/compose',
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify( {'model_name':model_name}),
          success: function(response) {
            document.getElementById('myiframe').contentWindow.getPydata(JSON.stringify(response.nodes),JSON.stringify(response.edges));
            document.getElementById('myiframe').contentWindow.drawGraph();
            network.fit()
          },
          error: function(error) {
              console.log(error);
          }
      });
    }
</script>
</head>
<div class="container">
  <div class="row">
    <div class="col-md-10 col-lg-8 mx-lg-auto mx-md-auto">

      <h1 class="pt-5 pb-2">CellML model composition</h1>
      <p class="lead">This is the page for a CellML model composition demo. </p>
      <h2 class = "model display"> Model Visualization </h2>
      <p>Click the model to view its structure and select the components to import.</p>
      <ul>
        {% for pair in pairs %}
            <li><a href="{{ url_for( 'detail', num=pair[0] ) }}"  target="_blank" >{{ pair[1] }}</a></li>
        {% endfor %}
      </ul>
      <p>The selected components are: </p>
      <ul>
        {% for selected_component in selected_components %}
            <li> {{selected_component[0]}}:{{selected_component[1]}}</li>
        {% endfor %}
      </ul>
      <h2 class = "Model composition"> Model Composition </h2>
      <label for="name">Please type the model name:</label>
      <input type="text" id="name" name="name" required minlength="1"  size="10">
      <button onclick="compose()">Compose the new model</button>
      <li><a href="{{ url_for( 'new_model_display' ) }}"  target="_blank" >go to new model</a></li>
      <p>Please provide an initial value for the following variables: </p>
      <ul>
        {% for form in forms %}
           {{ render_form(form) }}
        {% endfor %}
      </ul>
      <div>The selected edge links: <span id="node-pair"></span></div>
      <button onclick="add_edge()">Select and add new connection</button>
      <p>The composed new model: </p>
      <iframe id="myiframe", src="{{url_for('static',filename='nx.html')}}",frameborder="0" width="100%"></iframe>
            
    </div>
  </div>
</div>



{% endblock %}